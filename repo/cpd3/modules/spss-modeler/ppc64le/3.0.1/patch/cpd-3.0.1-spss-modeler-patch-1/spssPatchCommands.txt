patch cm spss-modeler-ibm-wml-canvas-prod-configmap -p '{"data": {"spss-modeler-server.json": "{\"displayName\":\"SPSS Modeler\",\"description\":\"SPSS Modeler Runtime\",\"annotations\":[{\"name\":\"cloudpakName\",\"value\":\"IBM Cloud Pak for Data Watson Studio Premium - SPSS Modeler Add On\"},{\"name\":\"cloudpakId\",\"value\":\"38fe119937c64484aed5493a36be88ed\"},{\"name\":\"cloudpakVersion\",\"value\":\"3.0.1\"},{\"name\":\"productMetric\",\"value\":\"VIRTUAL_PROCESSOR_CORE\"},{\"name\":\"productChargedContainers\",\"value\":\"All\"},{\"name\":\"productID\",\"value\":\"ICP4D-addon-SPSS-Modeler_3_0_1\"},{\"name\":\"productName\",\"value\":\"SPSS Modeler for Watson Studio\"},{\"name\":\"productVersion\",\"value\":\"3.0.1\"}],\"author\":\"IBM\",\"tested\":true,\"isService\":true,\"runtimeType\":\"spss-modeler\",\"features\":[\"environment\",\"SPSS Modeler\",\"worker\"],\"portMappings\":[{\"servicePort\":9443,\"containerPort\":9443,\"protocol\":\"TCP\"}],\"replicas\":1,\"image\":\"{{ .DockerRegistryPrefix }}/flow-session:8247-ppcle\",\"privileged\":false,\"command\":[\".\/modeler-service-1.0\/startup.sh\"],\"env\":[{\"name\":\"SERVICE_IMAGE_NAME\",\"value\":\"flow-session\"},{\"name\":\"CPUS_PER_POD\",\"value\":\"4\"},{\"name\":\"SERVICE_CPU\",\"value\":\"4\"},{\"name\":\"SERVICE_MEM\",\"value\":\"16Gi\"},{\"name\":\"MODELER_SERVER_HOST\",\"value\":\"localhost\"},{\"name\":\"DEVELOPMENT_MODE\",\"value\":\"false\"},{\"name\":\"USE_ICONSET\",\"value\":\"v1\/\"},{\"name\":\"PLAY_OPTS\",\"value\":\"-J-Xms1024M -J-Xmx3072M -J-Dfile.encoding=UTF-8\"},{\"name\":\"ULIMIT_MEM\",\"value\":\"8388608\"},{\"name\":\"OMP_NUM_THREADS\",\"value\":\"4\"},{\"name\":\"TRUST_SELF_SIGNED_CERTIFICATES\",\"value\":\"1\"},{\"name\":\"DEPLOYMENT_TARGET\",\"value\":\"local\"},{\"name\":\"LOCALFS_ROOT_PATH\",\"value\":\"\/\"},{\"name\":\"NGINX_SERVICE_SSL_CERTIFICATE_FILE_PATH\",\"value\":\"\/etc\/certificate\/certificate.pem\"},{\"name\":\"STREAMS_URL\",\"value\":\"https:\/\/internal-nginx-svc:12443\/flow-api\"},{\"name\":\"ML_SERVICE_BASE_URL\",\"value\":\"https:\/\/internal-nginx-svc:12443\"},{\"name\":\"MODEL_VIEWER_SERVICE\",\"value\":\"https:\/\/internal-nginx-svc:12443\/model-viewer\"},{\"name\":\"MODEL_VIEWER_BROWSER_PREFIX\",\"value\":\"\/model-viewer\"}],\"probes\":{\"liveness\":{\"path\":\"\/monitor\",\"scheme\":\"https\",\"port\":9443,\"initialDelaySeconds\":90,\"failureThreshold\":3,\"timeoutSeconds\":3,\"periodSeconds\":30},\"readiness\":{\"path\":\"\/monitor\",\"scheme\":\"https\",\"port\":9443,\"initialDelaySeconds\":10,\"failureThreshold\":3,\"timeoutSeconds\":2,\"periodSeconds\":3}},\"volumes\":[{\"volume\":\"project_dir\",\"mountPath\":\"\/project_data\",\"claimName\":\"file-api-claim\",\"subPath\":\"projects\/$project_id\/assets\"}],\"resources\":{\"cpu\":{\"request\":2048,\"minimum\":2000},\"gpu\":{\"request\":-1,\"minimum\":0},\"memory\":{\"request\":16384,\"minimum\":0},\"duration\":{\"value\":-1,\"units\":\"unix\"}}}"}}'
run spss-prepull-imagejobs --image {{ .DockerRegistryPrefix }}/flow-session:8247-ppcle --restart OnFailure --overrides '{ "spec": {  "backoffLimit": 6,  "completions": 30,  "parallelism": 30,  "template": {"metadata": { "labels": {  "app.kubernetes.io/instance": "spss-prepull-imagejobs",  "run": "spss-prepull-imagejobs" }},"spec": { "affinity": {  "nodeAffinity": {"requiredDuringSchedulingIgnoredDuringExecution": { "nodeSelectorTerms": [{  "matchExpressions": [{"key": "beta.kubernetes.io/arch","operator": "In","values": ["ppc64le"]  }] }]}  },  "podAntiAffinity": {"requiredDuringSchedulingIgnoredDuringExecution": [{ "labelSelector": {  "matchExpressions": [{"key": "run","operator": "In","values": ["spss-prepull-imagejobs"]  }] }, "topologyKey": "kubernetes.io/hostname"}]  } }, "containers": [{  "command": ["echo", "Image preloaded"],  "image": "{{ .DockerRegistryPrefix }}/flow-session:8247-ppcle",  "imagePullPolicy": "Always",  "name": "spss-prepull-image-container" }]}  } }}'
run spss-copycm-job --image {{ .DockerRegistryPrefix }}/pre-installer:991-ppcle --replicas 1 --restart OnFailure --overrides '{"spec": {"template": {"spec": {"affinity": {"nodeAffinity": {"requiredDuringSchedulingIgnoredDuringExecution": {"nodeSelectorTerms": [{"matchExpressions": [{"key": "beta.kubernetes.io/arch","operator": "In","values": ["ppc64le"]}]}]}}},"containers": [{"command": ["/bin/bash", "-c", "/usr/local/bin/copyToSpawner.sh"],"image": "{{.DockerRegistryPrefix }}/pre-installer:991-ppcle","env": [{"name": "RUNTIME_DEF_SOURCE_PATH","value": "/tmp/runtimedefinition/..data/spss-modeler-server.json"}, {"name": "RUNTIME_DEF_TARGET_PATH","value": "/user-home/_global_/config/.runtime-definitions/ibm/spss-modeler-server.json"}],"imagePullPolicy": "Always","name": "spss-copycm-container","resources": {"limits": {"cpu": "200m","memory": "216Mi"},"requests": {"cpu": "200m","memory": "216Mi"}},"securityContext": {"allowPrivilegeEscalation": false,"capabilities": {"drop": ["ALL"]},"privileged": false,"readOnlyRootFilesystem": false,"runAsNonRoot": true},"volumeMounts": [{"mountPath": "/tmp/runtimedefinition","name": "rt-def-cm"}]}],"restartPolicy": "OnFailure","securityContext": {"runAsNonRoot": true,"runAsUser": 1000320999},"serviceAccount": "cpd-editor-sa","serviceAccountName": "cpd-editor-sa","volumes": [{"name": "rt-def-cm","configMap": {"name": "spss-modeler-ibm-wml-canvas-prod-configmap"}}]}}}}'
run spss-cleanup-job --image {{ .DockerRegistryPrefix }}/pre-installer:991-ppcle --replicas 1 --restart OnFailure --overrides '{"spec": {"template": {"spec": {"affinity": {"nodeAffinity": {"requiredDuringSchedulingIgnoredDuringExecution": {"nodeSelectorTerms": [{"matchExpressions": [{"key": "beta.kubernetes.io/arch","operator": "In","values": ["ppc64le"]}]}]}}},"containers": [{"command": ["/bin/bash", "-c", "/usr/local/bin/cleanup-patch-job.sh"],"image": "{{.DockerRegistryPrefix }}/pre-installer:991-ppcle","env": [{"name": "MONITORED_JOBS","value": "spss-prepull-imagejobs spss-copycm-job spss-cleanup-job "}],"imagePullPolicy": "Always","name": "cleanup-job-container","resources": {"limits": {"cpu": "200m","memory": "216Mi"},"requests": {"cpu": "200m","memory": "216Mi"}},"securityContext": {"allowPrivilegeEscalation": false,"capabilities": {"drop": ["ALL"]},"privileged": false,"readOnlyRootFilesystem": false,"runAsNonRoot": true}}],"restartPolicy": "OnFailure","securityContext": {"runAsNonRoot": true,"runAsUser": 1000320999},"serviceAccount": "cpd-editor-sa","serviceAccountName": "cpd-editor-sa"}}}}'
